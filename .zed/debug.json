[
  {
    "label": "LLDB Rust Kernel EFI",
    "adapter": "CodeLLDB",
    "request": "launch",
    "program": "$ZED_WORKTREE_ROOT/target/debug/kernel.efi",
    "cwd": "$ZED_WORKTREE_ROOT",
    "build": {
      //"command": "cd drivers; if ($?) { cargo build }; if ($?) { cd ../os }; if ($?) { cargo build }; if ($?) { cd .. }; if ($?) { & 'C:/Program Files/qemu/qemu-system-x86_64w.exe' -m 8G -cpu 'qemu64,+apic,+acpi' -machine 'q35,accel=tcg' -smp 1 -gdb 'tcp::1234' -drive 'if=pflash,format=raw,readonly=on,file=C:/Program Files/qemu/OVMF_X64.fd' -drive 'file=target/debug/boot.img,format=raw' -drive 'file=rustOS.vhdx,if=none,format=vhdx,id=sysdisk' -device 'virtio-blk-pci,drive=sysdisk' }",
      "command": "cd drivers; if ($?) { cargo build }; if ($?) { cd ../os }; if ($?) { cargo build }; if ($?) { cd .. }; if ($?) { & 'C:/Program Files/qemu/qemu-system-x86_64w.exe' -m 8G -cpu 'qemu64,+apic,+acpi' -machine 'type=pc,accel=tcg' -smp 8 -gdb 'tcp::1234' -S -drive 'if=pflash,format=raw,readonly=on,file=C:/Program Files/qemu/OVMF_X64.fd' -drive 'file=target/debug/boot.img,format=raw' -drive 'file=rustOS.vhdx,if=ide' }",
    },

    "initCommands": [
      "settings set target.debug-file-search-paths \"drivers/target/x86_64-rustos-driver/debug/deps\"",
    ],
    "processCreateCommands": ["gdb-remote localhost:1234"],
    "postRunCommands": [
      "target modules load --file kernel.efi .text 0xFFFF850000000000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/acpi.dll\"",
      "target modules load --file \"acpi.dll\" .text 0xffff900002813000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/pci.dll\"",
      "target modules load --file \"pci.dll\" .text 0xffff900002e93000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/virtio.dll\"",
      "target modules load --file \"virtio.dll\" .text 0xffff9000132b6000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/disk.dll\"",
      "target modules load --file \"disk.dll\" .text 0xffff9000149f6000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/partmgr.dll\"",
      "target modules load --file \"partmgr.dll\" .text 0xffff900014c0d000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/volmgr.dll\"",
      "target modules load --file \"volmgr.dll\" .text 0xffff900014e2e000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/mountmgr.dll\"",
      "target modules load --file \"mountmgr.dll\" .text 0xffff900015061000",

      "target modules add \"drivers/target/x86_64-rustos-driver/debug/deps/fat32.dll\"",
      "target modules load --file \"fat32.dll\" .text 0xffff90000ff7b000",
    ],
    "sourceLanguages": ["rust"],
  },
]
